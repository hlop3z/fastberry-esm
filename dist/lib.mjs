/*! 
* Fastberry @ Copyright 2023
* MIT @ License 
*/
/* eslint-disable */

import { reactive } from "vue";
function q(s){if(s){let t=Object.keys(s);if(t.length===1)return s[t[0]]}return s}function O(s,t=["error","meta","messages"]){let r=!!s.errors,e=s.errors?s.errors:[],i=s.data,n=s.errors?"request":null;return s.errors||Object.keys(i).forEach(o=>{let a=Object.keys(i[o]);JSON.stringify(a)===JSON.stringify(t)&&i[o].error===!0&&(r=!0,n="input")}),r&&n==="input"&&(i=null,e=s.data),{data:q(i),errors:e,error:r,errorType:n}}function p(s){return function(r=null,e={}){return new Promise(i=>{s.$graphqlBase(r,e).then(n=>{i(O(n))}).catch(n=>{i({data:null,errors:[n],error:!0,errorType:"network"})})})}}function N(s){return s.match(/\b(?:query|mutation)\b([^{\n]*){([^}]*)}/g)}function E(s){let t=s.match(/\$([A-Za-z][A-Za-z0-9]*):[ ]?([A-Za-z_][A-Za-z0-9_]*[!]?)/g),r=[];return t&&t.forEach(e=>{r.push(e.split(":"))}),r}function L(s){return s.match(/\s*(\w+)/g)[1].trim()}function T(s){let t=N(s),r={};return t.forEach(e=>{let i={},n=L(e);E(e).forEach(c=>{let g=c[0].trim().replace("$","");i[g]={name:g,type:c[1].trim().replace("!",""),required:c[1].endsWith("!")}});let a={};Object.values(i).forEach(c=>{a[c.name]=null}),r[n]={args:i,form:a}}),r}var d=T;function w(s){let t=[];return s.forEach(r=>{t.push(r.node)}),t}function P(s){let t={};return!s.error&&s.data&&(s.data.edges?(t.$type="list",t.items=w(s.data.edges),s.data.pageInfo&&(t.pageInfo=s.data.pageInfo)):(t.$type="dict",t.data=s.data)),t}var f=class{constructor(t){this.$script=t.script?t.script:"",this.$api=t.api?t.api:{};let r=d(this.$script);r.$keys=Object.keys(r),this.op=Object.freeze(r)}get api(){return this.$api}crud(t,r=null){return this.$api.$crud(this.$script,{operationName:t,variables:r})}run(t,r=null){return this.$api.$graphqlBase(this.$script,{operationName:t,variables:r})}};function y(s={}){return new f(s)}function b(s){return(t=null,r={})=>new Promise(e=>{s.$graphql(t,r).then(i=>{let n={...i};i.error||(n.data=P(i)),e(n)})})}function h(s,t){return new Promise((r,e)=>{fetch(s,t).then(i=>i.json()).then(i=>r(i)).catch(i=>e(i))})}function R(s,t){let r=s.endsWith("/")?s:s+"/",e=t.startsWith("/")?t.substring(1):t;return r+e}var l=class{constructor(t,r){this.host=t,this.options=r,this.baseURL=e=>R(this.host,e),this.$graphql=p(this),this.$crud=b(this),this.graphql=e=>y({api:this,script:e})}static createAPI(t,r={}){let e={mode:"cors",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json; charset=UTF-8"}};return new l(t,{...e,...r})}get(t=null,r=!1){let e=r?`?${new URLSearchParams(r).toString()}`:"",i=`${this.baseURL(t)}${e}`,n={method:"GET"},o={...this.options,...n};return h(i,o)}post(t=null,r=!1){let e=`${this.baseURL(t)}`,i=r&&JSON.stringify(r),n={method:"POST"};r&&(n.body=i);let o={...this.options,...n};return h(e,o)}put(t=null,r=!1){let e=`${this.baseURL(t)}`,i=r&&JSON.stringify(r),n={method:"PUT"};r&&(n.body=i);let o={...this.options,...n};return h(e,o)}delete(t=null,r=!1){let e=`${this.baseURL(t)}`,i=r&&JSON.stringify(r),n={method:"DELETE"};r&&(n.body=i);let o={...this.options,...n};return h(e,o)}patch(t=null,r=!1){let e=`${this.baseURL(t)}`,i=r&&JSON.stringify(r),n={method:"PATCH"};r&&(n.body=i);let o={...this.options,...n};return h(e,o)}$graphqlBase(t=null,r={}){let e=r||{},i={query:t},n=e.operationName?e.operationName:null,o=e.variables?e.variables:null;return o&&(i.variables=o),n&&(i.operationName=n),this.post("graphql",i)}},$=l.createAPI;var u=class{constructor(t=!1,r=3){this._maxSize=r;let e={history:[],current:null,loading:!0,error:{}};t&&(e.info={},e.selected=[],e.pagination=reactive({page:1,limit:50,sortBy:"-id",all:!1})),this._=reactive(e)}setbyAPI(t){this._.current=t,this._.history.push(t),this._.history.length>this._maxSize&&this._.history.shift()}get last(){return this._.history[this._.history.length-2]}get history(){return this._.history}get pagination(){return this._.pagination}get selected(){return this._.selected}set current(t){return this.setbyAPI(t)}get current(){return this._.current}get loading(){return this._.loading}set loading(t){this._.loading=t}get error(){return this._.error}set error(t){this._.error=t}get info(){return this._.info}set info(t){this._.info=t}},m=class{constructor(t="http://localhost:8000",r){this.api=$(t,r),this._graphql={}}get graphql(){return this._graphql}get gql(){return this._graphql}model(t,r){let e=this.api.graphql(r),i={methods:Object.freeze(e.op.$keys),form:{},args:{},ops:{},item:new u(!1),list:new u(!0),search:new u(!0)};return e.op.$keys.forEach(n=>{i.ops[n]=a=>e.crud(n,a);let o=e.op[n];Object.keys(o.form).length>0?(i.form[n]=reactive(o.form),i.args[n]=o.args):(i.form[n]={},i.args[n]={})}),this._graphql[t]=i,this._graphql[t]}models(t){return Object.keys(t).forEach(r=>{let e=t[r];this.model(r,e)}),this.graphql}};function S(...s){return new m(...s)}var _=S;var G=_;export{G as default};
