/*! 
* Fastberry @ Copyright 2023
* MIT @ License 
*/
/* eslint-disable */
function $(e){if(e){let t=Object.keys(e);if(t.length===1)return e[t[0]]}return e}function b(e,t=["error","meta","messages"]){let r=!!e.errors,n=e.errors?e.errors:[],o=e.data,s=e.errors?"request":null;return e.errors||Object.keys(o).forEach(i=>{let u=Object.keys(o[i]);JSON.stringify(u)===JSON.stringify(t)&&o[i].error===!0&&(r=!0,s="input")}),r&&s==="input"&&(o=null,n=e.data),{data:$(o),errors:n,error:r,errorType:s}}function h(e){return function(r=null,n={}){return new Promise(o=>{e.$graphqlBase(r,n).then(s=>{o(b(s))}).catch(s=>{o({data:null,errors:[s],error:!0,errorType:"network"})})})}}function N(e){return e.match(/\b(?:query|mutation)\b([^{\n]*){([^}]*)}/g)}function O(e){let t=e.match(/\$([A-Za-z][A-Za-z0-9]*):[ ]?([A-Za-z_][A-Za-z0-9_]*[!]?)/g),r=[];return t&&t.forEach(n=>{r.push(n.split(":"))}),r}function L(e){return e.match(/\s*(\w+)/g)[1].trim()}function T(e){let t=N(e),r={};return t.forEach(n=>{let o={},s=L(n);O(n).forEach(a=>{let f=a[0].trim().replace("$","");o[f]={name:f,type:a[1].trim().replace("!",""),required:a[1].endsWith("!")}});let u={};Object.values(o).forEach(a=>{u[a.name]=null}),r[s]={args:o,form:u}}),r}var m=T;function E(e){let t=[];return e.forEach(r=>{t.push(r.node)}),t}function R(e){let t={};return!e.error&&e.data&&(e.data.edges?(t.$type="list",t.items=E(e.data.edges),e.data.pageInfo&&(t.pageInfo=e.data.pageInfo)):(t.$type="dict",t.data=e.data)),t}var l=class{constructor(t){this.$script=t.script?t.script:"",this.$api=t.api?t.api:{},this.op=Object.freeze(m(this.$script))}get api(){return this.$api}crud(t,r=null){return this.$api.$crud(this.$script,{operationName:t,variables:r})}run(t,r=null){return this.$api.$graphqlBase(this.$script,{operationName:t,variables:r})}};function g(e={}){return new l(e)}function y(e){return(t=null,r={})=>new Promise(n=>{e.$graphql(t,r).then(o=>{let s={...o};o.error||(s.data=R(o)),n(s)})})}function c(e,t){return new Promise((r,n)=>{fetch(e,t).then(o=>o.json()).then(o=>r(o)).catch(o=>n(o))})}function U(e,t){let r=e.endsWith("/")?e:e+"/",n=t.startsWith("/")?t.substring(1):t;return r+n}var p=class{constructor(t,r){this.host=t,this.options=r,this.baseURL=n=>U(this.host,n),this.$graphql=h(this),this.$crud=y(this),this.graphql=n=>g({api:this,script:n})}static createAPI(t,r={}){let n={mode:"cors",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json; charset=UTF-8"}};return new p(t,{...n,...r})}get(t=null,r=!1){let n=r?`?${new URLSearchParams(r).toString()}`:"",o=`${this.baseURL(t)}${n}`,s={method:"GET"},i={...this.options,...s};return c(o,i)}post(t=null,r=!1){let n=`${this.baseURL(t)}`,o=r&&JSON.stringify(r),s={method:"POST"};r&&(s.body=o);let i={...this.options,...s};return c(n,i)}put(t=null,r=!1){let n=`${this.baseURL(t)}`,o=r&&JSON.stringify(r),s={method:"PUT"};r&&(s.body=o);let i={...this.options,...s};return c(n,i)}delete(t=null,r=!1){let n=`${this.baseURL(t)}`,o=r&&JSON.stringify(r),s={method:"DELETE"};r&&(s.body=o);let i={...this.options,...s};return c(n,i)}patch(t=null,r=!1){let n=`${this.baseURL(t)}`,o=r&&JSON.stringify(r),s={method:"PATCH"};r&&(s.body=o);let i={...this.options,...s};return c(n,i)}$graphqlBase(t=null,r={}){let n=r||{},o={query:t},s=n.operationName?n.operationName:null,i=n.variables?n.variables:null;return i&&(o.variables=i),s&&(o.operationName=s),this.post("graphql",o)}},d=p.createAPI;var A=d;export{A as default};
