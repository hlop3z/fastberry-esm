/*! 
* Fastberry @ Copyright 2023
* MIT @ License 
*/
/* eslint-disable */

import { reactive } from "vue";
function q(e){if(e){let r=Object.keys(e);if(r.length===1)return e[r[0]]}return e}function O(e,r=["error","meta","messages"]){let t=!!e.errors,s=e.errors?e.errors:[],o=e.data,n=e.errors?"request":null;return e.errors||Object.keys(o).forEach(i=>{let a=Object.keys(o[i]);JSON.stringify(a)===JSON.stringify(r)&&o[i].error===!0&&(t=!0,n="input")}),t&&n==="input"&&(o=null,s=e.data),{data:q(o),errors:s,error:t,errorType:n}}function l(e){return function(t=null,s={}){return new Promise(o=>{e.$graphqlBase(t,s).then(n=>{o(O(n))}).catch(n=>{o({data:null,errors:[n],error:!0,errorType:"network"})})})}}function N(e){return e.match(/\b(?:query|mutation)\b([^{\n]*){([^}]*)}/g)}function E(e){let r=e.match(/\$([A-Za-z][A-Za-z0-9]*):[ ]?([A-Za-z_][A-Za-z0-9_]*[!]?)/g),t=[];return r&&r.forEach(s=>{t.push(s.split(":"))}),t}function L(e){return e.match(/\s*(\w+)/g)[1].trim()}function T(e){let r=N(e),t={};return r.forEach(s=>{let o={},n=L(s);E(s).forEach(c=>{let m=c[0].trim().replace("$","");o[m]={name:m,type:c[1].trim().replace("!",""),required:c[1].endsWith("!")}});let a={};Object.values(o).forEach(c=>{a[c.name]=null}),t[n]={args:o,form:a}}),t}var g=T;function R(e){let r=[];return e.forEach(t=>{r.push(t.node)}),r}function U(e){let r={};return!e.error&&e.data&&(e.data.edges?(r.$type="list",r.items=R(e.data.edges),e.data.pageInfo&&(r.pageInfo=e.data.pageInfo)):(r.$type="dict",r.data=e.data)),r}var u=class{constructor(r){this.$script=r.script?r.script:"",this.$api=r.api?r.api:{};let t=g(this.$script);t.$keys=Object.keys(t),this.op=Object.freeze(t)}get api(){return this.$api}crud(r,t=null){return this.$api.$crud(this.$script,{operationName:r,variables:t})}run(r,t=null){return this.$api.$graphqlBase(this.$script,{operationName:r,variables:t})}};function d(e={}){return new u(e)}function $(e){return(r=null,t={})=>new Promise(s=>{e.$graphql(r,t).then(o=>{let n={...o};o.error||(n.data=U(o)),s(n)})})}function p(e,r){return new Promise((t,s)=>{fetch(e,r).then(o=>o.json()).then(o=>t(o)).catch(o=>s(o))})}function j(e,r){let t=e.endsWith("/")?e:e+"/",s=r.startsWith("/")?r.substring(1):r;return t+s}var h=class{constructor(r,t){this.host=r,this.options=t,this.baseURL=s=>j(this.host,s),this.$graphql=l(this),this.$crud=$(this),this.graphql=s=>d({api:this,script:s})}static createAPI(r,t={}){let s={mode:"cors",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json; charset=UTF-8"}};return new h(r,{...s,...t})}get(r=null,t=!1){let s=t?`?${new URLSearchParams(t).toString()}`:"",o=`${this.baseURL(r)}${s}`,n={method:"GET"},i={...this.options,...n};return p(o,i)}post(r=null,t=!1){let s=`${this.baseURL(r)}`,o=t&&JSON.stringify(t),n={method:"POST"};t&&(n.body=o);let i={...this.options,...n};return p(s,i)}put(r=null,t=!1){let s=`${this.baseURL(r)}`,o=t&&JSON.stringify(t),n={method:"PUT"};t&&(n.body=o);let i={...this.options,...n};return p(s,i)}delete(r=null,t=!1){let s=`${this.baseURL(r)}`,o=t&&JSON.stringify(t),n={method:"DELETE"};t&&(n.body=o);let i={...this.options,...n};return p(s,i)}patch(r=null,t=!1){let s=`${this.baseURL(r)}`,o=t&&JSON.stringify(t),n={method:"PATCH"};t&&(n.body=o);let i={...this.options,...n};return p(s,i)}$graphqlBase(r=null,t={}){let s=t||{},o={query:r},n=s.operationName?s.operationName:null,i=s.variables?s.variables:null;return i&&(o.variables=i),n&&(o.operationName=n),this.post("graphql",o)}},y=h.createAPI;var f=class{constructor(r="http://localhost:8000",t){this.api=y(r,t),this._graphql={}}get graphql(){return this._graphql}get gql(){return this._graphql}model(r,t){let s=this.api.graphql(t),o={methods:Object.freeze(s.op.$keys),form:{},args:{},ops:{}};return s.op.$keys.forEach(n=>{o.ops[n]=a=>s.crud(n,a);let i=s.op[n];Object.keys(i.form).length>0?(o.form[n]=reactive(i.form),o.args[n]=i.args):(o.form[n]={},o.args[n]={})}),this._graphql[r]=o,this._graphql[r]}models(r){return Object.keys(r).forEach(t=>{let s=r[t];this.model(t,s)}),this.graphql}};function S(...e){return new f(...e)}var b=S;var D=b;export{D as default};
